# 8æ—¥ç›®

ã“ã‚“ã«ã¡ã¯ï¼8æ—¥ç›®ã‚’æ‹…å½“ã™ã‚‹[ã‚€ã‚‰ã“ã—(@hrk_mrks)](https://x.com/hrk_mrks)ã§ã™ï¼

## 7æ—¥ç›®ã®ãŠã•ã‚‰ã„ :streamlit: 
7æ—¥ç›®ã§ã¯èª­ã¿è¾¼ã‚“ã CSVãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢ã‚„0åŸ‹ã‚(filna)ã€ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦å­¦ã³ã¾ã—ãŸï¼  

#### å‰å›ã¾ã§ã®ã‚³ãƒ¼ãƒ‰
```py:work2_day3.py
import streamlit as st
import pandas as pd

st.title("ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆé…é€è¨ˆç”» ğŸ¦Œ")

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
uploaded_file = st.file_uploader("CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„", type=["csv"])
if uploaded_file is None:
    st.write("ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“")
    st.stop()

# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
data = pd.read_csv(uploaded_file)

# ãƒ‡ãƒ¼ã‚¿ã®ä¸­èº«ã‚’è¡¨ç¤ºã™ã‚‹
st.dataframe(data)

# å›½ã®ä¸€è¦§ã‚’å–å¾—ã™ã‚‹
countries = data["area_jp"].unique()
# st.write("å›½ã®ä¸€è¦§ï¼š", countries)

# è¡¨ç¤ºã™ã‚‹å›½ã‚’é¸æŠã™ã‚‹
selected_countries = st.multiselect("ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹å›½ã‚’é¸æŠã—ã¦ãã ã•ã„", countries, default=countries[:3])
# st.write("é¸æŠã•ã‚ŒãŸå›½ï¼š", selected_countries)

# åˆè¨ˆã‚’è¨ˆç®—ã—ã¦è¡¨ç¤ºã™ã‚‹
filtered_data = data[data["area_jp"].isin(selected_countries)]
total_delivered_count = filtered_data["delivered_count"].sum()
st.metric("ğŸ äºˆå®šé…é”æ•°", total_delivered_count)

# å¤‰å½¢ã™ã‚‹
pivot_data = data.pivot(index="time_utc", columns="area_jp", values="delivered_count")
# é¸æŠã—ãŸå›½ã ã‘æŠ½å‡ºã—ãŸå¾Œã«ã€ãƒ‡ãƒ¼ã‚¿ãŒãªã„éƒ¨åˆ†ã‚’0ã§åŸ‹ã‚ã‚‹
chart_data = pivot_data.filter(items=selected_countries).fillna(0).reset_index()

# å¤‰å½¢ã—ãŸå¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¡¨ç¤º
st.caption("ã‚°ãƒ©ãƒ•ç”¨ãƒ‡ãƒ¼ã‚¿")
st.dataframe(chart_data)
# ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆã‚’æç”»
st.caption("ã‚°ãƒ©ãƒ•")
st.line_chart(chart_data, x="time_utc", y=selected_countries, height=500)
```

## 8æ—¥ç›®ã®ã‚¢ãƒ—ãƒªã‚’å‹•ã‹ãã†ï¼
8æ—¥ç›®ã§ã¯ã€Œã‚¿ãƒ–ã€ã®è¡¨ç¤ºã‚„ã€Œãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€ã®è¡¨ç¤ºã«ã¤ã„ã¦å­¦ã³ã¾ã™ï¼  
æ—©é€Ÿã§ã™ãŒã€[Streamlit Playground](https://streamlit.io/playground?example=blank)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

```py:work2_day4.py
import streamlit as st
import pandas as pd

st.title("ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆé…é€è¨ˆç”» ğŸ¦Œ")

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
uploaded_file = st.file_uploader("CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„", type=["csv"])
if uploaded_file is None:
    st.write("ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“")
    st.stop()

# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
data = pd.read_csv(uploaded_file)

# ãƒ‡ãƒ¼ã‚¿ã®ä¸­èº«ã‚’è¡¨ç¤ºã™ã‚‹
st.dataframe(data)

# å›½ã®ä¸€è¦§ã‚’å–å¾—ã™ã‚‹
countries = data["area_jp"].unique()
# st.write("å›½ã®ä¸€è¦§ï¼š", countries)

# è¡¨ç¤ºã™ã‚‹å›½ã‚’é¸æŠã™ã‚‹
selected_countries = st.multiselect("ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹å›½ã‚’é¸æŠã—ã¦ãã ã•ã„", countries, default=countries[:3])
# st.write("é¸æŠã•ã‚ŒãŸå›½ï¼š", selected_countries)

# åˆè¨ˆã‚’è¨ˆç®—ã—ã¦è¡¨ç¤ºã™ã‚‹
filtered_data = data[data["area_jp"].isin(selected_countries)]
total_delivered_count = filtered_data["delivered_count"].sum()
st.metric("ğŸ äºˆå®šé…é”æ•°", total_delivered_count)

# ã‚¿ãƒ–ã‚’2ã¤ä½œæˆã™ã‚‹
tab1, tab2 = st.tabs(["ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆ :material/show_chart:", "ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ :material/bar_chart:"])

# ã‚¿ãƒ–1: ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆ
with tab1:
    # å¤‰å½¢ã™ã‚‹
    pivot_data = data.pivot(index="time_utc", columns="area_jp", values="delivered_count")
    # é¸æŠã—ãŸå›½ã ã‘æŠ½å‡ºã—ãŸå¾Œã«ã€ãƒ‡ãƒ¼ã‚¿ãŒãªã„éƒ¨åˆ†ã‚’0ã§åŸ‹ã‚ã‚‹
    chart_data = pivot_data.filter(items=selected_countries).fillna(0).reset_index()

    # å¤‰å½¢ã—ãŸå¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¡¨ç¤º
    st.caption("ã‚°ãƒ©ãƒ•ç”¨ãƒ‡ãƒ¼ã‚¿")
    st.dataframe(chart_data)
    # ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆã‚’æç”»
    st.caption("ã‚°ãƒ©ãƒ•")
    st.line_chart(chart_data, x="time_utc", y=selected_countries, height=500)

# ã‚¿ãƒ–2: ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
with tab2:
    # å¤‰å½¢ã™ã‚‹
    pivot_data = data.pivot(index="time_utc", columns="area_jp", values="delivered_count")
    # é¸æŠã—ãŸå›½ã ã‘æŠ½å‡ºã—ãŸå¾Œã«ã€ãƒ‡ãƒ¼ã‚¿ãŒãªã„éƒ¨åˆ†ã‚’0ã§åŸ‹ã‚ã‚‹
    chart_data = pivot_data.filter(items=selected_countries).fillna(0).reset_index()

    # å¤‰å½¢ã—ãŸå¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¡¨ç¤º
    st.caption("ã‚°ãƒ©ãƒ•ç”¨ãƒ‡ãƒ¼ã‚¿")
    st.dataframe(chart_data)
    # ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’æç”»
    st.caption("ã‚°ãƒ©ãƒ•")
    st.bar_chart(chart_data, x="time_utc", y=selected_countries, height=500)

```
#### ã‚¿ãƒ–ã¨ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®ç¢ºèª
ã‚¢ãƒ—ãƒªç”»é¢ä¸‹éƒ¨ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã€Œã‚¿ãƒ–ã€ã¨ã€Œãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ï¼  
ã“ã‚Œã‹ã‚‰é †ç•ªã«è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚  

![Day8 APP](app/static/day8_example1.png "ã‚¢ãƒ—ãƒªè¡¨ç¤ºã®ç¢ºèª")  

## è§£èª¬
#### ã‚¿ãƒ–ã®è¡¨ç¤ºï¼ˆ```st.tabs```ï¼‰
Streamlitã§ã¯ã€```st.tabs```ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã‚¿ãƒ–ãŒä½œæˆã§ãã¾ã™ï¼  
ãã‚Œãã‚Œã®ã‚¿ãƒ–ã®ä¸­ã§è¡¨ç¤ºã—ãŸã„å†…å®¹ã¯ã€Œwithã€ã‚’ç”¨ã„ã¦è¨˜è¿°ã—ã¾ã™ã€‚
```py
# ã‚¿ãƒ–ã‚’2ã¤ä½œæˆã™ã‚‹
tab1, tab2 = st.tabs(["ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆ", "ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ"])

# ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆã‚¿ãƒ–ã§è¡¨ç¤ºã—ãŸã„å†…å®¹
with tab1:
    st.write("ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆ")

# ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚¿ãƒ–ã§è¡¨ç¤ºã—ãŸã„å†…å®¹
with tab2:
    st.write("ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ")

# withã®å¤–ãªã‚‰ã€ã©ã¡ã‚‰ã®ã‚¿ãƒ–ã«ã‚‚è¡¨ç¤ºã•ã‚Œã‚‹
st.write("ã“ã“ã¯ã©ã¡ã‚‰ã®ã‚¿ãƒ–ã«ã‚‚è¡¨ç¤ºã•ã‚Œã‚‹ï¼")
```

![Day8 tab1](app/static/day8_example2.png "tab1_ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆ")

![Day8 tab2](app/static/day8_example3.png "tab2_ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ")

#### ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®è¡¨ç¤ºï¼ˆ```st.bar_chart```ï¼‰
ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®è¡¨ç¤ºã«ã¯```st.bar_chart```ã‚’ç”¨ã„ã¾ã™ã€‚  
å®Ÿã¯ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆ(```st.line_chart```)ã¨å…¥ã‚Œæ›¿ãˆã‚‹ã ã‘ã§ã€ç°¡å˜ã«ã‚°ãƒ©ãƒ•ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼
```py
# ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
st.bar_chart(chart_data, x="time_utc", y=selected_countries, height=500)

# ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆ
st.line_chart(chart_data, x="time_utc", y=selected_countries, height=500)
```

ãƒãƒ¼ã®è‰²ã‚’æŒ‡å®šã—ãŸã‚Šã€ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’ç¸¦ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚  
ãã®ä»–ã«ã‚‚ã„ãã¤ã‹å¼•æ•°ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚ã”èˆˆå‘³ãŒã‚ã‚‹äººã¯[å…¬å¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://docs.streamlit.io/develop/api-reference/charts/st.bar_chart)ã‚’å‚ç…§ã—ã¦ã¿ã¦ãã ã•ã„ï¼
```py
# ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®è‰²ã‚’æŒ‡å®šã—ã€ç¸¦ã‚°ãƒ©ãƒ•ã¸å¤‰æ›´ã€‚
st.bar_chart(chart_data, x="time_utc", y=selected_countries, height=500, color=["#FF0000", "#0000FF", "#CCCCCC"], horizontal=True)
```

![Day8 APP](app/static/day8_example4.png "ãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®å¼•æ•°")  

## æ¬¡å›äºˆå‘Š
[Streamlitã®å…¬å¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://docs.streamlit.io/develop/api-reference/charts)ã«ã¯ã€ä»Šå›ç´¹ä»‹ã—ãŸãƒãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚„ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆä»¥å¤–ã«ã‚‚æ§˜ã€…ãªãƒãƒ£ãƒ¼ãƒˆãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚  
èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ãœã²è¦—ã„ã¦ã¿ã¦ãã ã•ã„ï¼  
æ¬¡å›ã¯ã•ã‚‰ã«ã‚¿ãƒ–ã‚’è¿½åŠ ã—ã¦ã€```st.map```ã‚’ä½¿ã£ãŸåœ°å›³è¡¨ç¾ã‚’å®Ÿè£…ã—ã¾ã™ï¼ãŠæ¥½ã—ã¿ã«ï¼